{"version":3,"sources":["../scripts.js"],"names":["$","document","ready","url","window","location","href","color","split","mpd","text","json","JSON","parse","imgURL","sku","sig","price","inventory","Number","attr","tags","api_key","secret","format","undefined","replace","each","parent_data","i","val","thisColor","toLowerCase","large_image_url","theSku","store_price","slice","theJSON","md5","console","log","data","FormData","append","xhr","XMLHttpRequest","withCredentials","addEventListener","readyState","responseText","open","send","Sailthru","track","onSuccess","onError"],"mappings":"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","sourcesContent":["$(document).ready(function() {\r\n  var url = window.location.href;\r\n  var color = url.split('#')[1];\r\n  var mpd = $('#the-mpd').text();\r\n  var json = JSON.parse(mpd);\r\n  var imgURL;\r\n  var sku;\r\n  var sig;\r\n  var price;\r\n  var inventory = Number($('meta[name=\"inventory\"]').attr('content'));\r\n  var tags = $('meta[name=\"sailthru.tags\"]').attr('content');\r\n  // console.log(`inventory: ${inventory}`);\r\n\r\n  var api_key = `8379ab7deccf4e4aa16a01990e0f4fa2`;\r\n  var secret = `a05b94dd5722b409a097f77b14795d05`;\r\n  var format = `json`;\r\n\r\n\r\n  if (color !== undefined) {\r\n\r\n    color = color.replace(/%20/g, \" \");\r\n\r\n    $.each(json.parent_data, function(i, val) {\r\n      var thisColor = val.color;\r\n      thisColor = thisColor.toLowerCase();\r\n\r\n      if (color == thisColor) {\r\n        imgURL = val.large_image_url;\r\n\r\n        var theSku = val.sku;\r\n        theSku = theSku.split('-');\r\n        theSku = theSku[0] + '-' + theSku[1];\r\n        sku = theSku;\r\n        // console.log(theSku);\r\n\r\n        price = val.store_price;\r\n        price = Number(price.slice(1)) * 100;\r\n        //console.log(price);\r\n      }\r\n    });\r\n\r\n    var theJSON = `{\"id\": \"${url}\", \"tags\": \"${tags}\", \"inventory\": ${inventory}, \"price\": ${price}, \"keys\": {\"sku\": \"${sku}\"}, \"images\":{\"full\": {\"url\": \"${imgURL}\"}, \"thumb\": {\"url\": \"${imgURL}\"}}}`;\r\n    sig = md5(secret + api_key + format + theJSON);\r\n\r\n\r\n    console.log(`\r\n    api_key: ${api_key}\r\n    sig: ${sig}\r\n    format: ${format}\r\n    \"json\": ${theJSON}\r\n    `);\r\n\r\n\r\n    // var settings = {\r\n    //   \"url\": \"https://api.sailthru.com/content\",\r\n    //   \"method\": \"POST\",\r\n    //   \"timeout\": 0,\r\n    //   \"dataType\": \"jsonp\",\r\n    //   \"headers\": {\r\n    //     \"Content-Type\": \"application/x-www-form-urlencoded\"\r\n    //   },\r\n    //   \"data\": {\r\n    //     \"api_key\": api_key,\r\n    //     \"sig\": sig,\r\n    //     \"format\": format,\r\n    //     \"json\": theJSON\r\n    //   }\r\n    // };\r\n\r\n    //console.log(settings);\r\n\r\n    // $.post(\"https://api.sailthru.com/content\", {\r\n    //     \"api_key\": api_key,\r\n    //     \"sig\": sig,\r\n    //     \"format\": format,\r\n    //     \"json\": theJSON\r\n    //   }, function(data) {\r\n    //     console.log('ajax sailthru content api update complete');\r\n    //     console.log(data);\r\n    //   },\r\n    //   \"jsonp\"\r\n    // );\r\n\r\n\r\n    // $.ajax(settings).done(function(response) {\r\n    //   console.log('ajax sailthru content api update complete');\r\n    //   console.log(response);\r\n    // });\r\n\r\n    // var data = `api_key=${api_key}&sig=${sig}&format=${format}&json=${theJSON}`;\r\n\r\n    // console.log(data);\r\n\r\n    // var xhr = new XMLHttpRequest();\r\n    // xhr.withCredentials = true;\r\n    //\r\n    // xhr.addEventListener(\"readystatechange\", function() {\r\n    //   if (this.readyState === 4) {\r\n    //     console.log(this.responseText);\r\n    //   }\r\n    // });\r\n    //\r\n    // xhr.open(\"POST\", \"https://api.sailthru.com/content\");\r\n    // xhr.setRequestHeader(\"Content-Type\", \"application/x-www-form-urlencoded\");\r\n    //\r\n    // xhr.send(data);\r\n\r\n\r\n    var data = new FormData();\r\n    data.append(\"api_key\", api_key);\r\n    data.append(\"format\", format);\r\n    data.append(\"json\", theJSON);\r\n    data.append(\"sig\", sig);\r\n\r\n    var xhr = new XMLHttpRequest();\r\n    xhr.withCredentials = true;\r\n\r\n    xhr.addEventListener(\"readystatechange\", function() {\r\n      if (this.readyState === 4) {\r\n        console.log(this.responseText);\r\n      }\r\n    });\r\n\r\n    xhr.open(\"POST\", \"https://api.sailthru.com/content\");\r\n\r\n    xhr.send(data);\r\n\r\n    if (imgURL !== undefined) {\r\n      $('meta[name=\"sailthru.image.full\"]').attr('content', imgURL);\r\n    }\r\n\r\n    if (sku !== undefined) {\r\n      $('meta[name=\"sku\"]').attr('content', sku);\r\n    }\r\n\r\n    if (price !== undefined) {\r\n      $('meta[name=\"sailthru.price\"]').attr('content', price);\r\n    }\r\n\r\n    Sailthru.track('pageview', {\r\n      \"url\": url,\r\n      onSuccess: function() {\r\n        console.log('trackPageView success');\r\n      },\r\n      onError: function() {\r\n        console.log('trackPageView failure');\r\n      }\r\n    });\r\n\r\n  }\r\n\r\n\r\n});"],"file":"scripts.js"}